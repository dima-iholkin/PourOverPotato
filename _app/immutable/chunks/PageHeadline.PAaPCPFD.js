var W=Object.defineProperty;var j=(t,e,n)=>e in t?W(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var i=(t,e,n)=>(j(t,typeof e!="symbol"?e+"":e,n),n);import{s as V,a as O,u as $,g as k,b as q}from"./scheduler.QZKnv3vM.js";import{S as K,i as G,e as H,c as z,a as X,d as E,x as J,g as Q,l as U,k as Y}from"./index.SYB2qcav.js";const b=(t,e)=>e.some(n=>t instanceof n);let _,L;function Z(){return _||(_=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function ee(){return L||(L=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const C=new WeakMap,y=new WeakMap,g=new WeakMap;function te(t){const e=new Promise((n,s)=>{const a=()=>{t.removeEventListener("success",o),t.removeEventListener("error",r)},o=()=>{n(l(t.result)),a()},r=()=>{s(t.error),a()};t.addEventListener("success",o),t.addEventListener("error",r)});return g.set(e,t),e}function ne(t){if(C.has(t))return;const e=new Promise((n,s)=>{const a=()=>{t.removeEventListener("complete",o),t.removeEventListener("error",r),t.removeEventListener("abort",r)},o=()=>{n(),a()},r=()=>{s(t.error||new DOMException("AbortError","AbortError")),a()};t.addEventListener("complete",o),t.addEventListener("error",r),t.addEventListener("abort",r)});C.set(t,e)}let D={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return C.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return l(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function x(t){D=t(D)}function se(t){return ee().includes(t)?function(...e){return t.apply(S(this),e),l(this.request)}:function(...e){return l(t.apply(S(this),e))}}function ae(t){return typeof t=="function"?se(t):(t instanceof IDBTransaction&&ne(t),b(t,Z())?new Proxy(t,D):t)}function l(t){if(t instanceof IDBRequest)return te(t);if(y.has(t))return y.get(t);const e=ae(t);return e!==t&&(y.set(t,e),g.set(e,t)),e}const S=t=>g.get(t);function ie(t,e,{blocked:n,upgrade:s,blocking:a,terminated:o}={}){const r=indexedDB.open(t,e),m=l(r);return s&&r.addEventListener("upgradeneeded",d=>{s(l(r.result),d.oldVersion,d.newVersion,l(r.transaction),d)}),n&&r.addEventListener("blocked",d=>n(d.oldVersion,d.newVersion,d)),m.then(d=>{o&&d.addEventListener("close",()=>o()),a&&d.addEventListener("versionchange",h=>a(h.oldVersion,h.newVersion,h))}).catch(()=>{}),m}const oe=["get","getKey","getAll","getAllKeys","count"],re=["put","add","delete","clear"],I=new Map;function T(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(I.get(e))return I.get(e);const n=e.replace(/FromIndex$/,""),s=e!==n,a=re.includes(n);if(!(n in(s?IDBIndex:IDBObjectStore).prototype)||!(a||oe.includes(n)))return;const o=async function(r,...m){const d=this.transaction(r,a?"readwrite":"readonly");let h=d.store;return s&&(h=h.index(m.shift())),(await Promise.all([h[n](...m),a&&d.done]))[0]};return I.set(e,o),o}x(t=>({...t,get:(e,n,s)=>T(e,n)||t.get(e,n,s),has:(e,n)=>!!T(e,n)||t.has(e,n)}));const ce=["continue","continuePrimaryKey","advance"],v={},R=new WeakMap,M=new WeakMap,de={get(t,e){if(!ce.includes(e))return t[e];let n=v[e];return n||(n=v[e]=function(...s){R.set(this,M.get(this)[e](...s))}),n}};async function*ue(...t){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...t)),!e)return;e=e;const n=new Proxy(e,de);for(M.set(n,e),g.set(n,S(e));e;)yield n,e=await(R.get(n)||e.continue()),R.delete(n)}function A(t,e){return e===Symbol.asyncIterator&&b(t,[IDBIndex,IDBObjectStore,IDBCursor])||e==="iterate"&&b(t,[IDBIndex,IDBObjectStore])}x(t=>({...t,get(e,n,s){return A(e,n)?ue:t.get(e,n,s)},has(e,n){return A(e,n)||t.has(e,n)}}));class P{constructor(e,n){i(this,"id");i(this,"name");i(this,"description");this.id=n,this.name=e.name,this.description=e.description}}class N{constructor(e){i(this,"name");i(this,"description");this.name=e.name,this.description=e.description}static create(e){const n=e.name.trim(),s=e.description.trim();if(n.length<3)return"ValidationFailed_NameMustBeAtLeast3CharsLong";const a={name:n,description:s};return new N(a)}}class F{constructor(e){i(this,"id");i(this,"name");i(this,"description");this.id=e.id,this.name=e.name,this.description=e.description}static create(e){const n=e.name.trim(),s=e.description.trim();if(n.length<3)return"ValidationFailed_NameMustBeAtLeast3CharsLong";const a={id:e.id,name:n,description:s};return new F(a)}}class fe{constructor(e,n){i(this,"id");i(this,"coffeeBeansId");i(this,"recipeTarget");i(this,"recipeResult");i(this,"recipeThoughts");i(this,"rating");i(this,"outWeight");i(this,"timestamp");this.id=n,this.coffeeBeansId=e.coffeeBeansId,this.recipeTarget=e.recipeTarget,this.recipeResult=e.recipeResult,this.recipeThoughts=e.recipeThoughts,this.rating=e.rating,this.outWeight=e.outWeight,this.timestamp=e.timestamp}}class B{constructor(e,n){i(this,"id");i(this,"name");i(this,"description");i(this,"nameLowerCase");this.id=n,this.name=e.name,this.description=e.description,this.nameLowerCase=e.nameLowerCase}toCoffeeBeans(){return new P(this,this.id)}}class he{constructor(e){i(this,"name");i(this,"description");i(this,"nameLowerCase");this.name=e.name,this.description=e.description,this.nameLowerCase=e.name.toLowerCase()}}class p{constructor(e,n){i(this,"id");i(this,"coffeeBeansId");i(this,"recipeTarget");i(this,"recipeResult");i(this,"recipeThoughts");i(this,"rating");i(this,"outWeight");i(this,"timestamp");this.id=n,this.coffeeBeansId=e.coffeeBeansId,this.recipeTarget=e.recipeTarget,this.recipeResult=e.recipeResult,this.recipeThoughts=e.recipeThoughts,this.rating=e.rating,this.outWeight=e.outWeight,this.timestamp=e.timestamp}toRecipe(){return new fe(this,this.id)}}class le{constructor(e){i(this,"coffeeBeansId");i(this,"recipeTarget");i(this,"recipeResult");i(this,"recipeThoughts");i(this,"rating");i(this,"outWeight");i(this,"timestamp");this.coffeeBeansId=e.coffeeBeansId,this.recipeTarget=e.recipeTarget,this.recipeResult=e.recipeResult,this.recipeThoughts=e.recipeThoughts,this.rating=e.rating,this.outWeight=e.outWeight,this.timestamp=e.timestamp}}const me="entities",pe=1,f="coffeeBeans",w="nameLowerCase",u="recipes";async function c(){return await ie(me,pe,{upgrade(t){if(t.objectStoreNames.contains(f)===!1&&t.createObjectStore(f,{keyPath:"id",autoIncrement:!0}).createIndex(w,w,{unique:!0}),t.objectStoreNames.contains(u)===!1){const e=t.createObjectStore(u,{keyPath:"id",autoIncrement:!0});e.createIndex("coffeeBeansId","coffeeBeansId",{unique:!1}),e.createIndex("outWeight","outWeight",{unique:!1}),e.createIndex("rating","rating",{unique:!1}),e.createIndex("timestamp","timestamp",{unique:!1})}}})}async function Ce(t){if(await we(t.name)!==void 0)return"Failure_NameAlreadyExist";const n=new he(t);try{const a=await(await c()).add(f,n);return new B(n,a).toCoffeeBeans()}catch(s){if(s instanceof DOMException&&s.name==="ConstraintError")return console.error(`A ConstraintError occurred while saving coffee beans "${t.name}" to the database.`),"Failure_NameAlreadyExist";throw s}}async function De(t){const e=await c(),n=new le(t),s=await e.add(u,n);return new p(n,s).toRecipe()}async function Se(){return await(await c()).count(f)>0}async function Re(){return await(await c()).count(u)>0}async function Ee(){const t=await c(),e=IDBKeyRange.bound(Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER);await t.delete(f,e),await t.delete(u,e)}async function _e(t){await(await c()).delete(f,t)}async function Le(t){await(await c()).delete(u,t)}async function Te(t){const e=await c(),n=await e.getAllFromIndex(u,"coffeeBeansId",t);return await Promise.all(n.map(async s=>await e.delete(u,s.id))),n.length}async function ve(t){const e=await c(),n=await e.getFromIndex(f,w,t.name.toLowerCase());if(n!==void 0&&n.id!==t.id)return"Failure_NameAlreadyExist";const s={id:t.id,name:t.name,description:t.description,nameLowerCase:t.name.toLowerCase()};await e.put(f,s);const a={name:s.name,description:s.description};return new P(a,s.id)}async function Ae(t){const e=await c(),n=new p(t,t.id);return await e.put(u,n),n.toRecipe()}async function xe(){return(await(await c()).getAll(f)).map(s=>new B(s,s.id).toCoffeeBeans())}async function Me(){return(await(await c()).getAll(u)).map(s=>new p(s,s.id).toRecipe())}async function Pe(t){const n=await(await c()).get(f,t);return n===void 0?n:new B(n,n.id).toCoffeeBeans()}async function we(t){const n=await(await c()).getFromIndex(f,w,t.toLowerCase());if(n!==void 0)return new B(n,n.id).toCoffeeBeans()}async function Ne(t){const n=await(await c()).get(u,t);if(n!==void 0)return new p(n,n.id).toRecipe()}async function Fe(t){return(await(await c()).getAllFromIndex(u,"coffeeBeansId",t)).map(a=>new p(a,a.id).toRecipe())}function ge(t){let e,n;const s=t[1].default,a=O(s,t,t[0],null);return{c(){e=H("h1"),a&&a.c(),this.h()},l(o){e=z(o,"H1",{class:!0});var r=X(e);a&&a.l(r),r.forEach(E),this.h()},h(){J(e,"class","svelte-v0zu8i")},m(o,r){Q(o,e,r),a&&a.m(e,null),n=!0},p(o,[r]){a&&a.p&&(!n||r&1)&&$(a,s,o,o[0],n?q(s,o[0],r,null):k(o[0]),null)},i(o){n||(U(a,o),n=!0)},o(o){Y(a,o),n=!1},d(o){o&&E(e),a&&a.d(o)}}}function Be(t,e,n){let{$$slots:s={},$$scope:a}=e;return t.$$set=o=>{"$$scope"in o&&n(0,a=o.$$scope)},[a,s]}class We extends K{constructor(e){super(),G(this,e,Be,ge,V,{})}}export{P as C,We as P,fe as R,Pe as a,xe as b,Fe as c,De as d,Ee as e,Le as f,Me as g,Ne as h,Ae as i,Te as j,_e as k,F as l,ve as m,we as n,N as o,Ce as p,Se as q,Re as r};
