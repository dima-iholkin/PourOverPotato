var x=Object.defineProperty;var k=(t,e,s)=>e in t?x(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var n=(t,e,s)=>(k(t,typeof e!="symbol"?e+"":e,s),s);class b{constructor(e){n(this,"id");n(this,"name");n(this,"description");this.id=e.id,this.name=e.name,this.description=e.description}static hasValidName(e){return e.name.trim().length<3?"ValidationFailed_NameMustBeAtLeast3CharsLong":!0}}class M{constructor(e){n(this,"name");n(this,"description");this.name=e.name,this.description=e.description}static create(e){if(b.hasValidName(e)==="ValidationFailed_NameMustBeAtLeast3CharsLong")return"ValidationFailed_NameMustBeAtLeast3CharsLong";const s=e.name.trim(),i=e.description.trim(),o={name:s,description:i};return new M(o)}}class _{constructor(e){n(this,"id");n(this,"name");n(this,"description");this.id=e.id,this.name=e.name,this.description=e.description}static create(e){if(b.hasValidName(e)==="ValidationFailed_NameMustBeAtLeast3CharsLong")return"ValidationFailed_NameMustBeAtLeast3CharsLong";const s=e.name.trim(),i=e.description.trim(),o={id:e.id,name:s,description:i};return new _(o)}}const E=(t,e)=>e.some(s=>t instanceof s);let v,y;function X(){return v||(v=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function q(){return y||(y=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const R=new WeakMap,D=new WeakMap,B=new WeakMap;function $(t){const e=new Promise((s,i)=>{const o=()=>{t.removeEventListener("success",a),t.removeEventListener("error",r)},a=()=>{s(h(t.result)),o()},r=()=>{i(t.error),o()};t.addEventListener("success",a),t.addEventListener("error",r)});return B.set(e,t),e}function H(t){if(R.has(t))return;const e=new Promise((s,i)=>{const o=()=>{t.removeEventListener("complete",a),t.removeEventListener("error",r),t.removeEventListener("abort",r)},a=()=>{s(),o()},r=()=>{i(t.error||new DOMException("AbortError","AbortError")),o()};t.addEventListener("complete",a),t.addEventListener("error",r),t.addEventListener("abort",r)});R.set(t,e)}let C={get(t,e,s){if(t instanceof IDBTransaction){if(e==="done")return R.get(t);if(e==="store")return s.objectStoreNames[1]?void 0:s.objectStore(s.objectStoreNames[0])}return h(t[e])},set(t,e,s){return t[e]=s,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function F(t){C=t(C)}function U(t){return q().includes(t)?function(...e){return t.apply(S(this),e),h(this.request)}:function(...e){return h(t.apply(S(this),e))}}function z(t){return typeof t=="function"?U(t):(t instanceof IDBTransaction&&H(t),E(t,X())?new Proxy(t,C):t)}function h(t){if(t instanceof IDBRequest)return $(t);if(D.has(t))return D.get(t);const e=z(t);return e!==t&&(D.set(t,e),B.set(e,t)),e}const S=t=>B.get(t);function G(t,e,{blocked:s,upgrade:i,blocking:o,terminated:a}={}){const r=indexedDB.open(t,e),u=h(r);return i&&r.addEventListener("upgradeneeded",c=>{i(h(r.result),c.oldVersion,c.newVersion,h(r.transaction),c)}),s&&r.addEventListener("blocked",c=>s(c.oldVersion,c.newVersion,c)),u.then(c=>{a&&c.addEventListener("close",()=>a()),o&&c.addEventListener("versionchange",p=>o(p.oldVersion,p.newVersion,p))}).catch(()=>{}),u}function ge(t,{blocked:e}={}){const s=indexedDB.deleteDatabase(t);return e&&s.addEventListener("blocked",i=>e(i.oldVersion,i)),h(s).then(()=>{})}const J=["get","getKey","getAll","getAllKeys","count"],K=["put","add","delete","clear"],I=new Map;function V(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(I.get(e))return I.get(e);const s=e.replace(/FromIndex$/,""),i=e!==s,o=K.includes(s);if(!(s in(i?IDBIndex:IDBObjectStore).prototype)||!(o||J.includes(s)))return;const a=async function(r,...u){const c=this.transaction(r,o?"readwrite":"readonly");let p=c.store;return i&&(p=p.index(u.shift())),(await Promise.all([p[s](...u),o&&c.done]))[0]};return I.set(e,a),a}F(t=>({...t,get:(e,s,i)=>V(e,s)||t.get(e,s,i),has:(e,s)=>!!V(e,s)||t.has(e,s)}));const Q=["continue","continuePrimaryKey","advance"],L={},j=new WeakMap,A=new WeakMap,Y={get(t,e){if(!Q.includes(e))return t[e];let s=L[e];return s||(s=L[e]=function(...i){j.set(this,A.get(this)[e](...i))}),s}};async function*Z(...t){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...t)),!e)return;e=e;const s=new Proxy(e,Y);for(A.set(s,e),B.set(s,S(e));e;)yield s,e=await(j.get(s)||e.continue()),j.delete(s)}function N(t,e){return e===Symbol.asyncIterator&&E(t,[IDBIndex,IDBObjectStore,IDBCursor])||e==="iterate"&&E(t,[IDBIndex,IDBObjectStore])}F(t=>({...t,get(e,s,i){return N(e,s)?Z:t.get(e,s,i)},has(e,s){return N(e,s)||t.has(e,s)}}));function Te(t,e){return t.favorite===e.favorite?ee(t,e):t.favorite===!0?-1:e.favorite===!0?1:0}function we(t,e){return t.outWeight===e.outWeight?T(t,e):t.outWeight-e.outWeight}function be(t,e){return t.outWeight===e.outWeight?T(t,e):e.outWeight-t.outWeight}function Be(t,e){return t.rating===e.rating?T(t,e):t.rating-e.rating}function ee(t,e){return t.rating===e.rating?T(t,e):e.rating-t.rating}function De(t,e){return t.timestamp.getTime()-e.timestamp.getTime()}function T(t,e){return e.timestamp.getTime()-t.timestamp.getTime()}class w{constructor(e){n(this,"id");n(this,"name");n(this,"nameLowerCase");n(this,"description");n(this,"softDeletionTimestamp");this.id=e.id,this.name=e.name,this.nameLowerCase=e.nameLowerCase,this.description=e.description,this.softDeletionTimestamp=e.softDeletionTimestamp}static fromCoffeeBeans(e){const s={...e,nameLowerCase:e.name.toLowerCase(),softDeletionTimestamp:void 0};return new w(s)}toCoffeeBeans(){return new b(this)}}class Ie{constructor(e){n(this,"name");n(this,"nameLowerCase");n(this,"description");n(this,"softDeletionTimestamp");this.name=e.name,this.nameLowerCase=e.name.toLowerCase(),this.description=e.description,this.softDeletionTimestamp=void 0}}class te extends b{constructor(s,i){super(s);n(this,"recipeCount");n(this,"latestRecipeTimestamp");n(this,"earliestRecipeTimestamp");this.recipeCount=i.recipeCount,this.latestRecipeTimestamp=i.latestRecipeTimestamp,this.earliestRecipeTimestamp=i.earliestRecipeTimestamp}}function se(t,e){const s={recipeCount:e.recipesCount,latestRecipeTimestamp:e.latestRecipeTimestamp?new Date(e.latestRecipeTimestamp):void 0,earliestRecipeTimestamp:e.earliestRecipeTimestamp?new Date(e.earliestRecipeTimestamp):void 0};return new te(t,s)}class ne{constructor(e){n(this,"id");n(this,"coffeeBeansId");n(this,"recipeTarget");n(this,"recipeResult");n(this,"recipeThoughts");n(this,"favorite");n(this,"rating");n(this,"outWeight");n(this,"timestamp");this.id=e.id,this.coffeeBeansId=e.coffeeBeansId,this.recipeTarget=e.recipeTarget,this.recipeResult=e.recipeResult,this.recipeThoughts=e.recipeThoughts,this.favorite=e.favorite,this.rating=e.rating,this.outWeight=e.outWeight,this.timestamp=e.timestamp}}class Ee{constructor(e){n(this,"coffeeBeansId");n(this,"recipeTarget");n(this,"recipeResult");n(this,"recipeThoughts");n(this,"favorite");n(this,"rating");n(this,"outWeight");n(this,"timestamp");this.coffeeBeansId=e.coffeeBeansId,this.recipeTarget=e.recipeTarget,this.recipeResult=e.recipeResult,this.recipeThoughts=e.recipeThoughts,this.favorite=e.favorite,this.rating=e.rating,this.outWeight=e.outWeight,this.timestamp=e.timestamp}}class l{constructor(e){n(this,"id");n(this,"coffeeBeansId");n(this,"recipeTarget");n(this,"recipeResult");n(this,"recipeThoughts");n(this,"favorite");n(this,"rating");n(this,"outWeight");n(this,"timestamp");n(this,"softDeletionTimestamp");this.id=e.id,this.coffeeBeansId=e.coffeeBeansId,this.recipeTarget=e.recipeTarget,this.recipeResult=e.recipeResult,this.recipeThoughts=e.recipeThoughts,this.favorite=e.favorite??!1,this.rating=e.rating,this.outWeight=e.outWeight,this.timestamp=e.timestamp,this.softDeletionTimestamp=e.softDeletionTimestamp}static fromRecipe(e){const s={...e,timestamp:e.timestamp.getTime(),softDeletionTimestamp:void 0};return new l(s)}toRecipe(){const e={...this,favorite:this.favorite??!1,timestamp:new Date(this.timestamp)};return new ne(e)}}class Re{constructor(e){n(this,"coffeeBeansId");n(this,"recipeTarget");n(this,"recipeResult");n(this,"recipeThoughts");n(this,"favorite");n(this,"rating");n(this,"outWeight");n(this,"timestamp");n(this,"softDeletionTimestamp");this.coffeeBeansId=e.coffeeBeansId,this.recipeTarget=e.recipeTarget,this.recipeResult=e.recipeResult,this.recipeThoughts=e.recipeThoughts,this.favorite=e.favorite??!1,this.rating=e.rating,this.outWeight=e.outWeight,this.timestamp=e.timestamp.getTime(),this.softDeletionTimestamp=void 0}toRecipeDB(e,s){return new l({...e,id:s})}}async function Ce(){const e=(await he()).transaction([f,d],"readonly"),i=(await e.objectStore(f).getAll()).filter(a=>a.softDeletionTimestamp===void 0).map(a=>new w(a).toCoffeeBeans()),o=[];for(const a of i){const r=await e.objectStore(d).get(a.id),u={recipesCount:(r==null?void 0:r.recipesCount)??0,latestRecipeTimestamp:r==null?void 0:r.latestRecipeTimestamp,earliestRecipeTimestamp:r==null?void 0:r.earliestRecipeTimestamp},c=se(a,u);o.push(c)}return await e.done,o}async function ie(t,e){var a,r;let s=await e.objectStore(d).get(t);const o=(await e.objectStore(m).index(P).getAll(t)).filter(u=>u.softDeletionTimestamp===void 0).map(u=>new l(u).toRecipe()).toSorted(T);s={id:t,recipesCount:o.length,latestRecipeTimestamp:(a=o[0])==null?void 0:a.timestamp.getTime(),earliestRecipeTimestamp:(r=o.at(-1))==null?void 0:r.timestamp.getTime()},await e.objectStore(d).put(s)}async function oe(t){if(t.db.objectStoreNames.contains(d)===!1)throw new Error(`Object store ${d} wasn't found.`);await t.objectStore(d).clear();const e=await t.objectStore(f).getAll();for(const s of e)await ie(s.id,t)}async function ae(t){if(t.db.objectStoreNames.contains(f)===!1)return;const e=await t.objectStore(f).getAll(),s=t;for(const i of e){const o={...i,softDeletionTimestamp:void 0},a=new w(o);await s.objectStore(f).put(a)}}async function re(t){if(t.db.objectStoreNames.contains(f)===!1)return;const e=await t.objectStore(f).getAll(),s=t;for(const i of e){const o={...i,softDeletionTimestamp:i.softDeleted?Date.now():void 0},a=new w(o);await s.objectStore(f).put(a)}}async function ce(t){if(t.db.objectStoreNames.contains(m)===!1)return;const e=await t.objectStore(m).getAll(),s=t;for(const i of e){const o={...i,favorite:!1,timestamp:i.timestamp.getTime(),softDeletionTimestamp:void 0},a=new l(o);await s.objectStore(m).put(a)}}async function fe(t){if(t.db.objectStoreNames.contains(m)===!1)return;const e=await t.objectStore(m).getAll(),s=t;for(const i of e){const o={...i,favorite:i.favorite??!1,softDeletionTimestamp:i.softDeleted?Date.now():void 0},a=new l(o);await s.objectStore(m).put(a)}}const ue=3,me="entities",f="coffeeBeans",m="recipes",d="enhancedCoffeeBeans",de="nameLowerCase",P="coffeeBeansId",W="softDeletionTimestamp";async function he(){return await G(me,ue,{async upgrade(t,e,s,i){switch(e){case 0:break;case 1:{const o=i;await ae(o),await ce(o);break}case 2:{const o=i;await re(o),await fe(o);break}}pe(i),await oe(i)}})}function pe(t){const e=t.db;e.objectStoreNames.contains(f)===!1&&e.createObjectStore(f,{keyPath:"id",autoIncrement:!0}),O(t,de),O(t,W),e.objectStoreNames.contains(m)===!1&&e.createObjectStore(m,{keyPath:"id",autoIncrement:!0}),g(t,P),g(t,"outWeight"),g(t,"rating"),g(t,"timestamp"),g(t,W),e.objectStoreNames.contains(d)===!1&&e.createObjectStore(d,{keyPath:"id"})}function O(t,e){t.objectStore(f).indexNames.contains(e)||t.objectStore(f).createIndex(e,e,{unique:!1})}function g(t,e){t.objectStore(m).indexNames.contains(e)||t.objectStore(m).createIndex(e,e,{unique:!1})}function Se(t){const e=new CustomEvent("addToast",{detail:{message:t,timeout:5e3}});document.dispatchEvent(e)}function je(t,e,s){const i=new CustomEvent("addToast",{detail:{message:t,timeout:1e4,onClickUndo:e,onUndoIgnored:s}});document.dispatchEvent(i)}export{f as C,me as D,d as E,m as R,W as S,Se as a,w as b,de as c,P as d,b as e,Ie as f,ne as g,je as h,Re as i,l as j,M as k,Ee as l,ge as m,oe as n,he as o,_ as p,De as q,ie as r,T as s,Te as t,ee as u,Be as v,be as w,we as x,Ce as y};
