var _=Object.defineProperty;var k=(t,e,n)=>e in t?_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var o=(t,e,n)=>(k(t,typeof e!="symbol"?e+"":e,n),n);const C=(t,e)=>e.some(n=>t instanceof n);let E,L;function K(){return E||(E=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function q(){return L||(L=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const D=new WeakMap,I=new WeakMap,B=new WeakMap;function $(t){const e=new Promise((n,s)=>{const r=()=>{t.removeEventListener("success",i),t.removeEventListener("error",a)},i=()=>{n(l(t.result)),r()},a=()=>{s(t.error),r()};t.addEventListener("success",i),t.addEventListener("error",a)});return B.set(e,t),e}function z(t){if(D.has(t))return;const e=new Promise((n,s)=>{const r=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",a),t.removeEventListener("abort",a)},i=()=>{n(),r()},a=()=>{s(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",i),t.addEventListener("error",a),t.addEventListener("abort",a)});D.set(t,e)}let S={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return D.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return l(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function N(t){S=t(S)}function G(t){return q().includes(t)?function(...e){return t.apply(T(this),e),l(this.request)}:function(...e){return l(t.apply(T(this),e))}}function J(t){return typeof t=="function"?G(t):(t instanceof IDBTransaction&&z(t),C(t,K())?new Proxy(t,S):t)}function l(t){if(t instanceof IDBRequest)return $(t);if(I.has(t))return I.get(t);const e=J(t);return e!==t&&(I.set(t,e),B.set(e,t)),e}const T=t=>B.get(t);function X(t,e,{blocked:n,upgrade:s,blocking:r,terminated:i}={}){const a=indexedDB.open(t,e),d=l(a);return s&&a.addEventListener("upgradeneeded",f=>{s(l(a.result),f.oldVersion,f.newVersion,l(a.transaction),f)}),n&&a.addEventListener("blocked",f=>n(f.oldVersion,f.newVersion,f)),d.then(f=>{i&&f.addEventListener("close",()=>i()),r&&f.addEventListener("versionchange",p=>r(p.oldVersion,p.newVersion,p))}).catch(()=>{}),d}const H=["get","getKey","getAll","getAllKeys","count"],Q=["put","add","delete","clear"],b=new Map;function v(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(b.get(e))return b.get(e);const n=e.replace(/FromIndex$/,""),s=e!==n,r=Q.includes(n);if(!(n in(s?IDBIndex:IDBObjectStore).prototype)||!(r||H.includes(n)))return;const i=async function(a,...d){const f=this.transaction(a,r?"readwrite":"readonly");let p=f.store;return s&&(p=p.index(d.shift())),(await Promise.all([p[n](...d),r&&f.done]))[0]};return b.set(e,i),i}N(t=>({...t,get:(e,n,s)=>v(e,n)||t.get(e,n,s),has:(e,n)=>!!v(e,n)||t.has(e,n)}));const U=["continue","continuePrimaryKey","advance"],x={},R=new WeakMap,F=new WeakMap,Y={get(t,e){if(!U.includes(e))return t[e];let n=x[e];return n||(n=x[e]=function(...s){R.set(this,F.get(this)[e](...s))}),n}};async function*Z(...t){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...t)),!e)return;e=e;const n=new Proxy(e,Y);for(F.set(n,e),B.set(n,T(e));e;)yield n,e=await(R.get(n)||e.continue()),R.delete(n)}function M(t,e){return e===Symbol.asyncIterator&&C(t,[IDBIndex,IDBObjectStore,IDBCursor])||e==="iterate"&&C(t,[IDBIndex,IDBObjectStore])}N(t=>({...t,get(e,n,s){return M(e,n)?Z:t.get(e,n,s)},has(e,n){return M(e,n)||t.has(e,n)}}));class A{constructor(e,n){o(this,"id");o(this,"name");o(this,"description");this.id=n,this.name=e.name,this.description=e.description}}class j{constructor(e){o(this,"name");o(this,"description");this.name=e.name,this.description=e.description}static create(e){const n=e.name.trim(),s=e.description.trim();if(n.length<3)return"ValidationFailed_NameMustBeAtLeast3CharsLong";const r={name:n,description:s};return new j(r)}}class P{constructor(e){o(this,"id");o(this,"name");o(this,"description");this.id=e.id,this.name=e.name,this.description=e.description}static create(e){const n=e.name.trim(),s=e.description.trim();if(n.length<3)return"ValidationFailed_NameMustBeAtLeast3CharsLong";const r={id:e.id,name:n,description:s};return new P(r)}}class W{constructor(e,n){o(this,"id");o(this,"coffeeBeansId");o(this,"recipeTarget");o(this,"recipeResult");o(this,"recipeThoughts");o(this,"rating");o(this,"outWeight");o(this,"timestamp");this.id=n,this.coffeeBeansId=e.coffeeBeansId,this.recipeTarget=e.recipeTarget,this.recipeResult=e.recipeResult,this.recipeThoughts=e.recipeThoughts,this.rating=e.rating,this.outWeight=e.outWeight,this.timestamp=e.timestamp}}function ce(t){const e=t.getTimezoneOffset()*6e4;return new Date(t.getTime()-e).toISOString().slice(0,-8)}function ee(t){const e=Date.parse(t);return new Date(e)}function de(t){const e=Math.floor((Date.now()-t.getTime())/1e3);if(Math.floor(e/86400)>=1){const i=new Date;return i.setDate(i.getDate()-1),i.toDateString()===t.toDateString()?"yesterday":t.toLocaleString(void 0,{dateStyle:"short"})}const s=Math.floor(e/3600);if(s>1)return s+" hours ago";if(s===1)return"1 hour ago";const r=Math.floor(e/60);return r>1?r+" minutes ago":"just now"}class y{constructor(e,n){o(this,"id");o(this,"name");o(this,"description");o(this,"nameLowerCase");this.id=n,this.name=e.name,this.description=e.description,this.nameLowerCase=e.nameLowerCase}toCoffeeBeans(){return new A(this,this.id)}}class te{constructor(e){o(this,"name");o(this,"description");o(this,"nameLowerCase");this.name=e.name,this.description=e.description,this.nameLowerCase=e.name.toLowerCase()}}class m{constructor(e,n){o(this,"id");o(this,"coffeeBeansId");o(this,"recipeTarget");o(this,"recipeResult");o(this,"recipeThoughts");o(this,"rating");o(this,"outWeight");o(this,"timestamp");this.id=n,this.coffeeBeansId=e.coffeeBeansId,this.recipeTarget=e.recipeTarget,this.recipeResult=e.recipeResult,this.recipeThoughts=e.recipeThoughts,this.rating=e.rating,this.outWeight=e.outWeight,this.timestamp=e.timestamp}toRecipe(){return new W(this,this.id)}}class ne{constructor(e){o(this,"coffeeBeansId");o(this,"recipeTarget");o(this,"recipeResult");o(this,"recipeThoughts");o(this,"rating");o(this,"outWeight");o(this,"timestamp");this.coffeeBeansId=e.coffeeBeansId,this.recipeTarget=e.recipeTarget,this.recipeResult=e.recipeResult,this.recipeThoughts=e.recipeThoughts,this.rating=e.rating,this.outWeight=e.outWeight,this.timestamp=e.timestamp}}const se="entities",w=1,h="coffeeBeans",g="nameLowerCase",u="recipes";async function c(){return await X(se,w,{upgrade(t){if(t.objectStoreNames.contains(h)===!1&&t.createObjectStore(h,{keyPath:"id",autoIncrement:!0}).createIndex(g,g,{unique:!0}),t.objectStoreNames.contains(u)===!1){const e=t.createObjectStore(u,{keyPath:"id",autoIncrement:!0});e.createIndex("coffeeBeansId","coffeeBeansId",{unique:!1}),e.createIndex("outWeight","outWeight",{unique:!1}),e.createIndex("rating","rating",{unique:!1}),e.createIndex("timestamp","timestamp",{unique:!1})}}})}async function ie(t){if(await re(t.name)!==void 0)return"Failure_NameAlreadyExist";const n=new te(t);try{const r=await(await c()).add(h,n);return new y(n,r).toCoffeeBeans()}catch(s){if(s instanceof DOMException&&s.name==="ConstraintError")return console.error(`A ConstraintError occurred while saving coffee beans "${t.name}" to the database.`),"Failure_NameAlreadyExist";throw s}}async function oe(t){const e=await c(),n=new ne(t),s=await e.add(u,n);return new m(n,s).toRecipe()}async function fe(){return await(await c()).count(h)>0}async function ue(){return await(await c()).count(u)>0}async function he(){const t=await c(),e=IDBKeyRange.bound(Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER);await t.delete(h,e),await t.delete(u,e)}async function pe(t){await(await c()).delete(h,t)}async function le(t){await(await c()).delete(u,t)}async function me(t){const e=await c(),n=await e.getAllFromIndex(u,"coffeeBeansId",t);return await Promise.all(n.map(async s=>await e.delete(u,s.id))),n.length}async function we(t){const e=await c(),n=await e.getFromIndex(h,g,t.name.toLowerCase());if(n!==void 0&&n.id!==t.id)return"Failure_NameAlreadyExist";const s={id:t.id,name:t.name,description:t.description,nameLowerCase:t.name.toLowerCase()};await e.put(h,s);const r={name:s.name,description:s.description};return new A(r,s.id)}async function ge(t){const e=await c(),n=new m(t,t.id);return await e.put(u,n),n.toRecipe()}async function Be(){const t={dbVersion:w,coffeeBeans:await O(),recipes:await V()},e=JSON.stringify(t);return new Blob([e],{type:"application/json"})}async function O(){return(await(await c()).getAll(h)).map(s=>new y(s,s.id).toCoffeeBeans())}async function V(){return(await(await c()).getAll(u)).map(s=>new m(s,s.id).toRecipe())}async function ye(t){const n=await(await c()).get(h,t);return n===void 0?n:new y(n,n.id).toCoffeeBeans()}async function re(t){const n=await(await c()).getFromIndex(h,g,t.toLowerCase());if(n!==void 0)return new y(n,n.id).toCoffeeBeans()}async function Ie(t){const n=await(await c()).get(u,t);if(n!==void 0)return new m(n,n.id).toRecipe()}async function be(t){return(await(await c()).getAllFromIndex(u,"coffeeBeansId",t)).map(r=>new m(r,r.id).toRecipe())}async function Ce(t){const e=JSON.parse(await t.text());if(e.dbVersion===void 0){alert("dbVersion property not found in the file.");return}if(e.dbVersion!==w){alert(`Expected dbVersion value: ${w}.`);return}if(e.coffeeBeans===void 0||Array.isArray(e.coffeeBeans)===!1){alert("coffeeBeans array not found.");return}if(e.recipes===void 0||Array.isArray(e.recipes)===!1){alert("recipes array not found.");return}const n=new Map,s=await O();for(let i of e.coffeeBeans){i=new A(i,i.id);const a=s.find(f=>f.name.toLowerCase()===i.name.toLowerCase());if(a!==void 0&&a.id===i.id){n.set(i.id,a.id);continue}else if(a!==void 0){n.set(i.id,a.id);continue}const d=await ie(i);if(d==="Failure_NameAlreadyExist")throw alert("Failure_NameAlreadyExist error during importing CoffeeBeans. This shouldn't be possible, sorry. Contact the developer, I guess."),new Error("Failure_NameAlreadyExist");n.set(i.id,d.id)}const r=await V();for(let i of e.recipes){if(i.timestamp=ee(i.timestamp),i=new W(i,i.id),n.has(i.coffeeBeansId)===!1)throw alert(`Could not find a correct CoffeeBeansId for imported recipe with Id ${i.id}. Sorry, something went wrong.`),new Error("Could not find a correct CoffeeBeansId for imported recipe.");i.coffeeBeansId=n.get(i.coffeeBeansId),r.find(d=>d.timestamp.getTime()===i.timestamp.getTime()&&d.outWeight===i.outWeight&&d.rating===i.rating&&d.recipeTarget===i.recipeTarget&&d.recipeResult===i.recipeResult&&d.recipeThoughts===i.recipeThoughts)===void 0&&await oe(i)}alert("CoffeeBeans and Recipes import finished.")}export{A as C,W as R,V as a,be as b,de as c,Ie as d,le as e,ce as f,O as g,ye as h,ge as i,oe as j,P as k,we as l,re as m,me as n,pe as o,ee as p,ie as q,fe as r,ue as s,j as t,he as u,Be as v,Ce as w};
