var F=Object.defineProperty;var j=(t,e,n)=>e in t?F(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var s=(t,e,n)=>(j(t,typeof e!="symbol"?e+"":e,n),n);class M{constructor(e,n){s(this,"id");s(this,"name");s(this,"description");this.id=n,this.name=e.name,this.description=e.description}}class v{constructor(e){s(this,"name");s(this,"description");this.name=e.name,this.description=e.description}static create(e){const n=e.name.trim(),i=e.description.trim();if(n.length<3)return"ValidationFailed_NameMustBeAtLeast3CharsLong";const r={name:n,description:i};return new v(r)}}class P{constructor(e){s(this,"id");s(this,"name");s(this,"description");this.id=e.id,this.name=e.name,this.description=e.description}static create(e){const n=e.name.trim(),i=e.description.trim();if(n.length<3)return"ValidationFailed_NameMustBeAtLeast3CharsLong";const r={id:e.id,name:n,description:i};return new P(r)}}class O{constructor(e,n){s(this,"id");s(this,"coffeeBeansId");s(this,"recipeTarget");s(this,"recipeResult");s(this,"recipeThoughts");s(this,"rating");s(this,"outWeight");s(this,"timestamp");this.id=n,this.coffeeBeansId=e.coffeeBeansId,this.recipeTarget=e.recipeTarget,this.recipeResult=e.recipeResult,this.recipeThoughts=e.recipeThoughts,this.rating=e.rating,this.outWeight=e.outWeight,this.timestamp=e.timestamp}}const y=(t,e)=>e.some(n=>t instanceof n);let T,x;function V(){return T||(T=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function k(){return x||(x=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const C=new WeakMap,g=new WeakMap,w=new WeakMap;function _(t){const e=new Promise((n,i)=>{const r=()=>{t.removeEventListener("success",a),t.removeEventListener("error",o)},a=()=>{n(h(t.result)),r()},o=()=>{i(t.error),r()};t.addEventListener("success",a),t.addEventListener("error",o)});return w.set(e,t),e}function $(t){if(C.has(t))return;const e=new Promise((n,i)=>{const r=()=>{t.removeEventListener("complete",a),t.removeEventListener("error",o),t.removeEventListener("abort",o)},a=()=>{n(),r()},o=()=>{i(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",a),t.addEventListener("error",o),t.addEventListener("abort",o)});C.set(t,e)}let b={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return C.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return h(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function N(t){b=t(b)}function K(t){return k().includes(t)?function(...e){return t.apply(D(this),e),h(this.request)}:function(...e){return h(t.apply(D(this),e))}}function q(t){return typeof t=="function"?K(t):(t instanceof IDBTransaction&&$(t),y(t,V())?new Proxy(t,b):t)}function h(t){if(t instanceof IDBRequest)return _(t);if(g.has(t))return g.get(t);const e=q(t);return e!==t&&(g.set(t,e),w.set(e,t)),e}const D=t=>w.get(t);function z(t,e,{blocked:n,upgrade:i,blocking:r,terminated:a}={}){const o=indexedDB.open(t,e),p=h(o);return i&&o.addEventListener("upgradeneeded",c=>{i(h(o.result),c.oldVersion,c.newVersion,h(o.transaction),c)}),n&&o.addEventListener("blocked",c=>n(c.oldVersion,c.newVersion,c)),p.then(c=>{a&&c.addEventListener("close",()=>a()),r&&c.addEventListener("versionchange",f=>r(f.oldVersion,f.newVersion,f))}).catch(()=>{}),p}const G=["get","getKey","getAll","getAllKeys","count"],H=["put","add","delete","clear"],I=new Map;function E(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(I.get(e))return I.get(e);const n=e.replace(/FromIndex$/,""),i=e!==n,r=H.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!(r||G.includes(n)))return;const a=async function(o,...p){const c=this.transaction(o,r?"readwrite":"readonly");let f=c.store;return i&&(f=f.index(p.shift())),(await Promise.all([f[n](...p),r&&c.done]))[0]};return I.set(e,a),a}N(t=>({...t,get:(e,n,i)=>E(e,n)||t.get(e,n,i),has:(e,n)=>!!E(e,n)||t.has(e,n)}));const J=["continue","continuePrimaryKey","advance"],R={},S=new WeakMap,W=new WeakMap,Q={get(t,e){if(!J.includes(e))return t[e];let n=R[e];return n||(n=R[e]=function(...i){S.set(this,W.get(this)[e](...i))}),n}};async function*U(...t){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...t)),!e)return;e=e;const n=new Proxy(e,Q);for(W.set(n,e),w.set(n,D(e));e;)yield n,e=await(S.get(n)||e.continue()),S.delete(n)}function A(t,e){return e===Symbol.asyncIterator&&y(t,[IDBIndex,IDBObjectStore,IDBCursor])||e==="iterate"&&y(t,[IDBIndex,IDBObjectStore])}N(t=>({...t,get(e,n,i){return A(e,n)?U:t.get(e,n,i)},has(e,n){return A(e,n)||t.has(e,n)}}));class B{constructor(e,n){s(this,"id");s(this,"name");s(this,"description");s(this,"nameLowerCase");this.id=n,this.name=e.name,this.description=e.description,this.nameLowerCase=e.nameLowerCase}toCoffeeBeans(){return new M(this,this.id)}}class X{constructor(e){s(this,"name");s(this,"description");s(this,"nameLowerCase");this.name=e.name,this.description=e.description,this.nameLowerCase=e.name.toLowerCase()}}class L{constructor(e,n){s(this,"id");s(this,"coffeeBeansId");s(this,"recipeTarget");s(this,"recipeResult");s(this,"recipeThoughts");s(this,"rating");s(this,"outWeight");s(this,"timestamp");this.id=n,this.coffeeBeansId=e.coffeeBeansId,this.recipeTarget=e.recipeTarget,this.recipeResult=e.recipeResult,this.recipeThoughts=e.recipeThoughts,this.rating=e.rating,this.outWeight=e.outWeight,this.timestamp=e.timestamp}toRecipe(){return new O(this,this.id)}}class Y{constructor(e){s(this,"coffeeBeansId");s(this,"recipeTarget");s(this,"recipeResult");s(this,"recipeThoughts");s(this,"rating");s(this,"outWeight");s(this,"timestamp");this.coffeeBeansId=e.coffeeBeansId,this.recipeTarget=e.recipeTarget,this.recipeResult=e.recipeResult,this.recipeThoughts=e.recipeThoughts,this.rating=e.rating,this.outWeight=e.outWeight,this.timestamp=e.timestamp}}const Z="entities",ee=1,u="coffeeBeans",l="nameLowerCase",m="recipes";async function d(){return await z(Z,ee,{upgrade(t){if(t.objectStoreNames.contains(u)===!1&&t.createObjectStore(u,{keyPath:"id",autoIncrement:!0}).createIndex(l,l,{unique:!0}),t.objectStoreNames.contains(m)===!1){const e=t.createObjectStore(m,{keyPath:"id",autoIncrement:!0});e.createIndex("coffeeBeansId","coffeeBeansId",{unique:!1}),e.createIndex("outWeight","outWeight",{unique:!1}),e.createIndex("rating","rating",{unique:!1}),e.createIndex("timestamp","timestamp",{unique:!1})}}})}async function se(t){if(await te(t.name)!==void 0)return"Failure_NameAlreadyExist";const n=new X(t);try{const r=await(await d()).add(u,n);return new B(n,r).toCoffeeBeans()}catch(i){if(i instanceof DOMException&&i.name==="ConstraintError")return console.error(`A ConstraintError occurred while saving coffee beans "${t.name}" to the database.`),"Failure_NameAlreadyExist";throw i}}async function ie(t){const e=await d(),n=new Y(t),i=await e.add(m,n);return new L(n,i).toRecipe()}async function re(){return await(await d()).count(u)>0}async function oe(){return await(await d()).count(m)>0}async function ae(t){const e=await d(),n=await e.getFromIndex(u,l,t.name.toLowerCase());if(n!==void 0&&n.id!==t.id)return"Failure_NameAlreadyExist";const i={id:t.id,name:t.name,description:t.description,nameLowerCase:t.name.toLowerCase()},r=await e.put(u,i);console.log(`Edit CoffeeBeans item. New name: ${t.name}. Old Id: ${t.id} New Id: ${r}.`);const a={name:i.name,description:i.description};return new M(a,i.id)}async function ce(){return(await(await d()).getAll(u)).map(i=>new B(i,i.id).toCoffeeBeans())}async function de(){return(await(await d()).getAll(m)).map(i=>new L(i,i.id).toRecipe())}async function ue(t){const n=await(await d()).get(u,t);return n===void 0?n:new B(n,n.id).toCoffeeBeans()}async function te(t){const n=await(await d()).getFromIndex(u,l,t.toLowerCase());if(n!==void 0)return new B(n,n.id).toCoffeeBeans()}async function fe(t){return(await(await d()).getAllFromIndex(m,"coffeeBeansId",t)).map(r=>new L(r,r.id).toRecipe())}async function he(t){return(await(await d()).getAllFromIndex(m,"coffeeBeansId",t)).length}export{M as C,ce as a,he as b,ue as c,re as d,se as e,oe as f,de as g,ie as h,P as i,ae as j,te as k,fe as l,v as m};
