var W=Object.defineProperty;var j=(t,e,n)=>e in t?W(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var i=(t,e,n)=>(j(t,typeof e!="symbol"?e+"":e,n),n);const b=(t,e)=>e.some(n=>t instanceof n);let E,L;function V(){return E||(E=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function _(){return L||(L=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const C=new WeakMap,y=new WeakMap,B=new WeakMap;function O(t){const e=new Promise((n,s)=>{const a=()=>{t.removeEventListener("success",d),t.removeEventListener("error",r)},d=()=>{n(p(t.result)),a()},r=()=>{s(t.error),a()};t.addEventListener("success",d),t.addEventListener("error",r)});return B.set(e,t),e}function k(t){if(C.has(t))return;const e=new Promise((n,s)=>{const a=()=>{t.removeEventListener("complete",d),t.removeEventListener("error",r),t.removeEventListener("abort",r)},d=()=>{n(),a()},r=()=>{s(t.error||new DOMException("AbortError","AbortError")),a()};t.addEventListener("complete",d),t.addEventListener("error",r),t.addEventListener("abort",r)});C.set(t,e)}let D={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return C.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return p(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function M(t){D=t(D)}function K(t){return _().includes(t)?function(...e){return t.apply(S(this),e),p(this.request)}:function(...e){return p(t.apply(S(this),e))}}function q(t){return typeof t=="function"?K(t):(t instanceof IDBTransaction&&k(t),b(t,V())?new Proxy(t,D):t)}function p(t){if(t instanceof IDBRequest)return O(t);if(y.has(t))return y.get(t);const e=q(t);return e!==t&&(y.set(t,e),B.set(e,t)),e}const S=t=>B.get(t);function G(t,e,{blocked:n,upgrade:s,blocking:a,terminated:d}={}){const r=indexedDB.open(t,e),m=p(r);return s&&r.addEventListener("upgradeneeded",c=>{s(p(r.result),c.oldVersion,c.newVersion,p(r.transaction),c)}),n&&r.addEventListener("blocked",c=>n(c.oldVersion,c.newVersion,c)),m.then(c=>{d&&c.addEventListener("close",()=>d()),a&&c.addEventListener("versionchange",h=>a(h.oldVersion,h.newVersion,h))}).catch(()=>{}),m}const $=["get","getKey","getAll","getAllKeys","count"],X=["put","add","delete","clear"],I=new Map;function T(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(I.get(e))return I.get(e);const n=e.replace(/FromIndex$/,""),s=e!==n,a=X.includes(n);if(!(n in(s?IDBIndex:IDBObjectStore).prototype)||!(a||$.includes(n)))return;const d=async function(r,...m){const c=this.transaction(r,a?"readwrite":"readonly");let h=c.store;return s&&(h=h.index(m.shift())),(await Promise.all([h[n](...m),a&&c.done]))[0]};return I.set(e,d),d}M(t=>({...t,get:(e,n,s)=>T(e,n)||t.get(e,n,s),has:(e,n)=>!!T(e,n)||t.has(e,n)}));const z=["continue","continuePrimaryKey","advance"],x={},R=new WeakMap,v=new WeakMap,H={get(t,e){if(!z.includes(e))return t[e];let n=x[e];return n||(n=x[e]=function(...s){R.set(this,v.get(this)[e](...s))}),n}};async function*J(...t){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...t)),!e)return;e=e;const n=new Proxy(e,H);for(v.set(n,e),B.set(n,S(e));e;)yield n,e=await(R.get(n)||e.continue()),R.delete(n)}function A(t,e){return e===Symbol.asyncIterator&&b(t,[IDBIndex,IDBObjectStore,IDBCursor])||e==="iterate"&&b(t,[IDBIndex,IDBObjectStore])}M(t=>({...t,get(e,n,s){return A(e,n)?J:t.get(e,n,s)},has(e,n){return A(e,n)||t.has(e,n)}}));class N{constructor(e,n){i(this,"id");i(this,"name");i(this,"description");this.id=n,this.name=e.name,this.description=e.description}}class P{constructor(e){i(this,"name");i(this,"description");this.name=e.name,this.description=e.description}static create(e){const n=e.name.trim(),s=e.description.trim();if(n.length<3)return"ValidationFailed_NameMustBeAtLeast3CharsLong";const a={name:n,description:s};return new P(a)}}class F{constructor(e){i(this,"id");i(this,"name");i(this,"description");this.id=e.id,this.name=e.name,this.description=e.description}static create(e){const n=e.name.trim(),s=e.description.trim();if(n.length<3)return"ValidationFailed_NameMustBeAtLeast3CharsLong";const a={id:e.id,name:n,description:s};return new F(a)}}class Q{constructor(e,n){i(this,"id");i(this,"coffeeBeansId");i(this,"recipeTarget");i(this,"recipeResult");i(this,"recipeThoughts");i(this,"rating");i(this,"outWeight");i(this,"timestamp");this.id=n,this.coffeeBeansId=e.coffeeBeansId,this.recipeTarget=e.recipeTarget,this.recipeResult=e.recipeResult,this.recipeThoughts=e.recipeThoughts,this.rating=e.rating,this.outWeight=e.outWeight,this.timestamp=e.timestamp}}class g{constructor(e,n){i(this,"id");i(this,"name");i(this,"description");i(this,"nameLowerCase");this.id=n,this.name=e.name,this.description=e.description,this.nameLowerCase=e.nameLowerCase}toCoffeeBeans(){return new N(this,this.id)}}class U{constructor(e){i(this,"name");i(this,"description");i(this,"nameLowerCase");this.name=e.name,this.description=e.description,this.nameLowerCase=e.name.toLowerCase()}}class l{constructor(e,n){i(this,"id");i(this,"coffeeBeansId");i(this,"recipeTarget");i(this,"recipeResult");i(this,"recipeThoughts");i(this,"rating");i(this,"outWeight");i(this,"timestamp");this.id=n,this.coffeeBeansId=e.coffeeBeansId,this.recipeTarget=e.recipeTarget,this.recipeResult=e.recipeResult,this.recipeThoughts=e.recipeThoughts,this.rating=e.rating,this.outWeight=e.outWeight,this.timestamp=e.timestamp}toRecipe(){return new Q(this,this.id)}}class Y{constructor(e){i(this,"coffeeBeansId");i(this,"recipeTarget");i(this,"recipeResult");i(this,"recipeThoughts");i(this,"rating");i(this,"outWeight");i(this,"timestamp");this.coffeeBeansId=e.coffeeBeansId,this.recipeTarget=e.recipeTarget,this.recipeResult=e.recipeResult,this.recipeThoughts=e.recipeThoughts,this.rating=e.rating,this.outWeight=e.outWeight,this.timestamp=e.timestamp}}const Z="entities",ee=1,f="coffeeBeans",w="nameLowerCase",u="recipes";async function o(){return await G(Z,ee,{upgrade(t){if(t.objectStoreNames.contains(f)===!1&&t.createObjectStore(f,{keyPath:"id",autoIncrement:!0}).createIndex(w,w,{unique:!0}),t.objectStoreNames.contains(u)===!1){const e=t.createObjectStore(u,{keyPath:"id",autoIncrement:!0});e.createIndex("coffeeBeansId","coffeeBeansId",{unique:!1}),e.createIndex("outWeight","outWeight",{unique:!1}),e.createIndex("rating","rating",{unique:!1}),e.createIndex("timestamp","timestamp",{unique:!1})}}})}async function se(t){if(await te(t.name)!==void 0)return"Failure_NameAlreadyExist";const n=new U(t);try{const a=await(await o()).add(f,n);return new g(n,a).toCoffeeBeans()}catch(s){if(s instanceof DOMException&&s.name==="ConstraintError")return console.error(`A ConstraintError occurred while saving coffee beans "${t.name}" to the database.`),"Failure_NameAlreadyExist";throw s}}async function ie(t){const e=await o(),n=new Y(t),s=await e.add(u,n);return new l(n,s).toRecipe()}async function ae(){return await(await o()).count(f)>0}async function oe(){return await(await o()).count(u)>0}async function re(){const t=await o(),e=IDBKeyRange.bound(Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER);await t.delete(f,e),await t.delete(u,e)}async function ce(t){await(await o()).delete(f,t)}async function de(t){await(await o()).delete(u,t)}async function ue(t){const e=await o(),n=await e.getAllFromIndex(u,"coffeeBeansId",t);return await Promise.all(n.map(async s=>await e.delete(u,s.id))),n.length}async function fe(t){const e=await o(),n=await e.getFromIndex(f,w,t.name.toLowerCase());if(n!==void 0&&n.id!==t.id)return"Failure_NameAlreadyExist";const s={id:t.id,name:t.name,description:t.description,nameLowerCase:t.name.toLowerCase()};await e.put(f,s);const a={name:s.name,description:s.description};return new N(a,s.id)}async function he(t){const e=await o(),n=new l(t,t.id);return await e.put(u,n),n.toRecipe()}async function pe(){return(await(await o()).getAll(f)).map(s=>new g(s,s.id).toCoffeeBeans())}async function me(){return(await(await o()).getAll(u)).map(s=>new l(s,s.id).toRecipe())}async function le(t){const n=await(await o()).get(f,t);return n===void 0?n:new g(n,n.id).toCoffeeBeans()}async function te(t){const n=await(await o()).getFromIndex(f,w,t.toLowerCase());if(n!==void 0)return new g(n,n.id).toCoffeeBeans()}async function we(t){const n=await(await o()).get(u,t);if(n!==void 0)return new l(n,n.id).toRecipe()}async function Be(t){return(await(await o()).getAllFromIndex(u,"coffeeBeansId",t)).map(a=>new l(a,a.id).toRecipe())}export{N as C,Q as R,me as a,Be as b,we as c,de as d,le as e,he as f,pe as g,re as h,ie as i,F as j,fe as k,te as l,ue as m,ce as n,se as o,ae as p,oe as q,P as r};
